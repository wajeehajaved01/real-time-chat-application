<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Room</title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="/eel.js"></script>
</head>
<body>
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Chat Rooms</h2>
                <button class="btn-icon" onclick="refreshRooms()" title="Refresh Rooms">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 10a6 6 0 0112 0v1h2a1 1 0 110 2h-3a1 1 0 01-1-1v-2a4 4 0 00-8 0v2a1 1 0 01-1 1H2a1 1 0 110-2h2v-1z"/>
                        <path d="M10 2a1 1 0 011 1v2a1 1 0 11-2 0V3a1 1 0 011-1z"/>
                    </svg>
                </button>
            </div>
            
            <div class="current-room">
                <div class="room-badge">
                    <span class="room-icon">üìç</span>
                    <div>
                        <div class="room-label">Current Room</div>
                        <div class="room-name" id="currentRoomName">lobby</div>
                    </div>
                </div>
            </div>
            
            <div class="create-room">
                <input 
                    type="text" 
                    id="newRoomInput" 
                    placeholder="Enter room name..."
                    onkeypress="handleRoomInputEnter(event)"
                >
                <button class="btn-secondary" onclick="joinRoom()">Join/Create</button>
            </div>
            
            <div class="rooms-list" id="roomsList">
                <div class="room-item active" onclick="joinRoomByName('lobby')">
                    <span class="room-icon">üè†</span>
                    <span>lobby</span>
                    <span class="room-count" id="lobby-count">0</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="username" id="currentUsername">Username</div>
                        <div class="connection-status">
                            <span class="status-dot connected"></span>
                            <span>Connected</span>
                        </div>
                    </div>
                </div>
                <button class="btn-danger" onclick="disconnect()">Disconnect</button>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="chat-main">
            <div class="chat-header">
                <div class="header-info">
                    <h2 id="chatRoomTitle">lobby</h2>
                    <p id="roomMembersCount">0 members</p>
                </div>
                <button class="btn-icon" onclick="showUsersPanel()" title="Show Users">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </button>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <h3>Welcome to the Chat!</h3>
                    <p>Start chatting with others in your room</p>
                </div>
            </div>
            
            <div class="message-input-container">
                <div class="input-wrapper">
                    <button class="btn-icon btn-attach" onclick="document.getElementById('fileInput').click()" title="Attach File">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
                        </svg>
                    </button>
                    <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(event)">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Type a message... (Use /pm username message for private chat)"
                        onkeypress="handleMessageEnter(event)"
                        autocomplete="off"
                    >
                    <button class="btn-primary" onclick="sendMessage()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 3l18 7-18 7 3-7-3-7zm4 6l-2 4 12-4-12-4 2 4z"/>
                        </svg>
                        Send
                    </button>
                </div>
                <div class="input-hints">
                    <span>üí° Commands: /pm [user] [msg] | /join [room] | /rooms | /help | üìé Attach files | üìû Voice calls in user list ‚Üí</span>
                </div>
            </div>
        </div>
        
        <!-- Users Panel (Right Sidebar) -->
        <div class="users-panel" id="usersPanel">
            <div class="users-header">
                <h3>Active Users</h3>
                <div style="display: flex; gap: 5px;">
                    <button class="btn-icon" onclick="refreshUserList()" title="Refresh Users">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <button class="btn-icon" onclick="hideUsersPanel()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="users-list" id="usersList">
                <div class="no-users">No users online</div>
            </div>
        </div>
    </div>

    <!-- Call Modals -->
    <div id="callIncomingModal" class="call-modal" style="display: none;">
        <div class="call-modal-content">
            <div class="call-icon">üìû</div>
            <h2>Incoming Call</h2>
            <p class="caller-name" id="callerName">Unknown</p>
            <div class="call-buttons">
                <button class="btn-success" onclick="acceptIncomingCall()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                    </svg>
                    Accept
                </button>
                <button class="btn-danger" onclick="rejectIncomingCall()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                    </svg>
                    Reject
                </button>
            </div>
        </div>
    </div>

    <div id="callActiveModal" class="call-modal" style="display: none;">
        <div class="call-modal-content">
            <div class="call-icon pulsing">üéôÔ∏è</div>
            <h2>Call Active</h2>
            <p class="partner-name" id="partnerName">Unknown</p>
            <div class="call-status">Voice connected</div>
            <button class="btn-danger btn-lg" onclick="hangupCall()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                </svg>
                Hang Up
            </button>
        </div>
    </div>

    <script src="chat.js"></script>
</body>
</html>
